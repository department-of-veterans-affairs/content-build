{% comment %}

=====================
 Navigation side bar
=====================

Used to display a side navigation bar of pages in a collection.

1. To define a collection, edit `build.js`.
2. Look for the line that begins `smith.use(collections` and edit as desired.
3. OR add a `collection` property to those pages you wish to group into a
   collection.

{% endcomment %}

{% assign relatedPages = collections | get: collection %}

{% if relatedPages.metadata.spokes != empty %}
  {% assign spokes = relatedPages.metadata.spokes %}
{% else %}
  {% assign spokes = "Get benefits,Manage benefits,More resources" | split: ',' %}
{% endif %}

<nav {% if relatedPages != empty %}class="usa-width-one-fourth va-sidebarnav {%  if newGrid == true %} new-grid{% endif %}"{% endif %} id="va-detailpage-sidebar">
  <div>
    <button type="button" aria-label="Close this menu" class="va-btn-close-icon va-sidebarnav-close"></button>

    {% if relatedPages != empty %}
      {% if relatedPages.metadata.name != empty %}
        <div class="vads-u-display--flex left-side-nav-title {% if newGrid %}vads-u-padding-x--0{% endif %}">
          {{ relatedPages.metadata.hub | getHubIcon: '3', 'vads-u-margin-right--1' }}
          <h4>{{ relatedPages.metadata.name }}</h4></div>
      {% endif %}

        <div class="sidenav-previous-page">
          <va-link 
            href="/{{ previous.path }}" 
            text="{{ previous.display_title if previous.display_title != empty else previous.title }}">
          </va-link>
        </div>
        <ul class="usa-sidenav-list">
          {% for page in relatedPages %}
            {% unless relatedPages.metadata.name == page.display_title or relatedPages.metadata.name == page.title or page.hideFromSidebar %}
              <li {% if page.path == path %}class="active-level"{% endif %}>
                {% if page.href != empty %}
                  <va-link 
                    href="{{ page.href }}" 
                    text="{{ page.display_title if page.display_title != empty else page.title }}">
                  </va-link>
                {% else %}
                  <va-link 
                    {% if page.path == path %}class="usa-current"{% endif %} 
                    href="/{{ page.path }}" 
                    text="{{ page.display_title if page.display_title != empty else page.title }}">
                  </va-link>
                {% endif %}
                {% if page.children != empty and path contains page.path %}
                  {% assign childPages = collections | get: page.children %}
                    <ul class="usa-sidenav-sub_list">
                    {% for cpage in childPages %}
                      {% unless cpage.hideFromSidebar %}
                        <li {% if cpage.path == path %}class="active-level"{% endif %}>
                          {% if cpage.href != empty %}
                          <va-link 
                            href="{{ cpage.href }}" 
                            text="{{ cpage.display_title if cpage.display_title != empty else cpage.title }}">
                          </va-link>
                            </a>
                          {% else %}
                          <va-link 
                            {% if cpage.path == path %}class="usa-current"{% endif %} 
                            href="/{{ cpage.path }}" 
                            text="{{ cpage.display_title if cpage.display_title != empty else cpage.title }}" >
                          </va-link>
                          {% endif %}
                        </li>
                      {% endunless %}
                    {% endfor %}
                    </ul>
                {% endif %}
              </li>
            {% endunless %}
          {% endfor %}
        </ul>
    {% endif %}
  </div>
</nav>
