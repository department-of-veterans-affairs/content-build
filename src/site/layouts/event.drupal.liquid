{% include "src/site/includes/header.html" %}
{% include "src/site/includes/preview-edit.drupal.liquid" %}
{% include "src/site/includes/breadcrumbs.drupal.liquid" with hideHomeBreadcrumb = true deriveBreadcrumbsFromUrl = true replaceLastItem = true %}

<div class="interior" id="content" data-template="layouts/event.drupal.liquid">
  <main class="va-l-detail-page va-facility-page">
    <div class="usa-grid usa-grid-full">
      {% unless entityUrl.path contains "/outreach-and-events" %}
        {% include 'src/site/navigation/facility_sidebar_nav.drupal.liquid' with sidebarData = facilitySidebar %}
      {% endunless %}

      <!-- Event v1 -->
      {% if buildtype == 'vagovprod' %}
        {% include "src/site/includes/date.drupal.liquid" %}

        <div class="usa-width-three-fourths">
          <article aria-labelledby="article-heading" class="usa-content" role="region">
            <div class="usa-grid usa-grid-full">
              <h1 id="article-heading" class="{% if fieldMedia %}vads-u-margin-bottom--4{% else %}vads-u-margin-bottom--2{% endif %}">
                {{ title }}
              </h1>

              {% if fieldMedia %}
                <img
                  alt="{{ fieldMedia.entity.image.alt }}"
                  class="event-detail-img vads-u-margin-bottom--3 medium-screen:vads-u-margin-bottom--4"
                  src="{{ fieldMedia.entity.image.derivative.url }}"
                />
              {% endif %}

              <div class="va-introtext">
                <p class="vads-u-margin-top--0 vads-u-margin-bottom--1 medium-screen:vads-u-margin-bottom--4">
                  {{ fieldDescription }}
                </p>
              </div>

              <div class="usa-width-one-half vads-u-margin-bottom--2p5 medium-screen:vads-u-margin-bottom--0">
                {% assign facility = fieldFacilityLocation.entity %}

                <dl class="va-c-event-info">
                  <dt class="vads-u-font-weight--bold when-where-width vads-u-margin-right--2">
                    When
                  </dt>

                  <dd>
                    {% if date_type == "start_date_only" %}
                      <span>{{ start_date_no_time }}</span>
                      <br>
                      <span>{{ start_time }}</span>
                    {% else %}
                      {% if date_type == "same_day" %}
                        <span>{{ start_date_no_time }}</span>
                        <br>
                        <span>{{ start_time }}
                          -
                          {{ end_time }}</span>
                      {% else %}
                        <span>{{ start_date_full }}
                          -</span>
                          <br>
                        <span>{{ end_date_full }}</span>
                      {% endif %}
                    {% endif %}
                    <span>{{ timezone }}</span>
                  </dd>
                </dl>

                {% if fieldFacilityLocation or fieldAddress.addressLine1 %}
                  <dl class="va-c-event-info">
                    <dt class="vads-u-font-weight--bold when-where-width vads-u-margin-right--2">
                      Where</dt>
                    <dd>
                      {% if facility %}
                        <p class="vads-u-margin--0">
                          <a href="{{ facility.entityUrl.path }}">{{ facility.title }}</a>
                        </p>
                        <p class="vads-u-margin--0">{{ fieldLocationHumanreadable }}</p>
                      {% else %}
                        {% if fieldAddress.addressLine1 %}
                          <p class="vads-u-margin--0">{{ fieldAddress.addressLine1 }}</p>
                        {% endif %}
                        {% if fieldAddress.addressLine2 %}
                          <p class="vads-u-margin--0">{{ fieldAddress.addressLine2 }}</p>
                        {% endif %}
                        <p class="vads-u-margin--0">
                          {% if fieldAddress.locality %}
                            {{ fieldAddress.locality }}
                          {% endif %}
                          {% if fieldAddress.administrativeArea %}
                            , {{ fieldAddress.administrativeArea }}
                          {% endif %}
                        </p>
                      {% endif %}
                    </dd>
                  </dl>
                {% endif %}

                {% if fieldEventCost %}
                  <dl class="va-c-event-info">
                    <dt class="vads-u-font-weight--bold vads-u-margin-right--2">Cost</dt>
                    <dd>
                      <span>{{ fieldEventCost }}</span>
                    </dd>
                  </dl>
                {% endif %}

                {% if fieldLink or fieldEventCta or fieldAdditionalInformationAbo %}
                  <div class="registration vads-u-margin-top--4 vads-u-margin-bottom--3 medium-screen:vads-u-margin-bottom--1">
                    <p class="vads-u-font-weight--bold vads-u-margin-top--0 vads-u-margin-bottom--1">Registration</p>

                    {% if start_timestamp < current_timestamp %}
                      <p class="vads-u-margin--0 vads-u-color--secondary vads-u-font-weight--bold">This event already happened.</p>
                    {% else %}
                      {% if fieldLink %}
                        <p class="vads-u-margin--0">
                          <a href="{{ fieldLink.url.path }}">
                            <button class="vads-u-margin--0">
                              {% if fieldEventCta %}
                                {{ fieldEventCta | removeUnderscores | capitalize }}
                              {% else %}
                                More details
                              {% endif %}
                            </button>
                          </a>
                        </p>
                      {% endif %}

                      {% if fieldAdditionalInformationAbo %}
                        <p class="vads-u-margin--0">{{ fieldAdditionalInformationAbo.processed | phoneLinks }}</p>
                      {% endif %}
                    {% endif %}
                  </div>
                {% endif %}
              </div>

              <div class="usa-width-one-half va-c-event-share vads-u-margin-bottom--1">
                {% include "src/site/includes/social-share.drupal.liquid" %}
              </div>
            </div>

            <div class="usa-grid usa-grid-full vads-u-margin-top--2">
              <div class="event-description">
                {{ fieldBody.processed }}
              </div>
            </div>

            {% assign index = entityUrl.breadcrumb.length | minus: 2 %}

            <a onclick="recordEvent({ event: 'nav-secondary-button-click' });" href="{{ entityUrl.breadcrumb | getValueFromArrayObjPath: index, 'url.path' }}">
              See all events
            </a>
          </article>

          <div class="last-updated usa-content">
            Last updated:
            <time datetime="{{ changed | dateFromUnix: 'YYYY-MM-DD'}}">{{ changed | humanizeTimestamp }}</time>
          </div>
        </div>

      <!-- Event v2 -->
      {% else %}
        <div class="usa-width-three-fourths vads-u-display--flex vads-u-flex-direction--column vads-u-padding-x--1p5 medium-screen:vads-u-padding-x--0 vads-u-padding-bottom--2">
          <h1>{{ title }}</h1>

          <!-- When -->
          <div class="vads-u-display--flex vads-u-flex-direction--row">
            <p class="vads-u-margin--0 vads-u-margin-right--0p5">
              <strong>When:</strong>
            </p>

            <div class="vads-u-display--flex vads-u-flex-direction--column">
              <!-- Starts at + ends at -->
              <p class="vads-u-margin--0">
                {formattedStartsAt} - {formattedEndsAt} {endsAtTimezone}
              </p>

              {% if fieldDatetimeRangeTimezone?.length > 1 %}
                <!-- Repeats -->
                <p class="vads-u-margin--0">
                  <i aria-hidden="true" class="fa fa-sync vads-u-font-size--sm vads-u-margin-right--0p5"></i> Repeats
                </p>
              {% endif %}
            </div>
          </div>

          <!-- Repeating event instances -->
          <button
            class="vads-u-background-color--gray-lightest vads-u-color--primary-darkest vads-u-font-weight--bold vads-u-display--flex vads-u-align-items--center vads-u-justify-content--space-between vads-u-height--full"
            id="expand-recurring-events"
            type="button"
          >
            Find other times for this event <i aria-hidden="true" class="fa fa-plus"></i>
          </button>

          <!-- Where -->
          <div class="vads-u-display--flex vads-u-flex-direction--row vads-u-margin-top--1">
            <p class="vads-u-margin--0 vads-u-margin-right--0p5">
              <strong>Where:</strong>
            </p>

            <p class="vads-u-margin--0">
              This is an online event.
            </p>
          </div>

          {% if fieldEventCost %}
            <!-- Cost -->
            <div class="vads-u-display--flex vads-u-flex-direction--row vads-u-margin-top--1">
              <p class="vads-u-margin--0 vads-u-margin-right--0p5">
                <strong>Cost:</strong>
              </p>

              <p class="vads-u-margin--0">
                {{ fieldEventCost }}
              </p>
            </div>
          {% endif %}

          <!-- Social links -->
          {% include "src/site/includes/social-share.drupal.liquid" %}

          {% if fieldLink or fieldEventCta or fieldAdditionalInformationAbo %}
            <!-- CTA -->
            <div class="registration vads-u-margin-top--4 vads-u-margin-bottom--3 medium-screen:vads-u-margin-bottom--1">
              <p class="vads-u-font-weight--bold vads-u-margin-top--0 vads-u-margin-bottom--1">Registration</p>

              {% if start_timestamp < current_timestamp %}
                <p class="vads-u-margin--0 vads-u-color--secondary vads-u-font-weight--bold">This event already happened.</p>
              {% else %}
                {% if fieldLink %}
                  <p class="vads-u-margin--0">
                    <a href="{{ fieldLink.url.path }}">
                      <button class="vads-u-margin--0">
                        {% if fieldEventCta %}
                          {{ fieldEventCta | removeUnderscores | capitalize }}
                        {% else %}
                          More details
                        {% endif %}
                      </button>
                    </a>
                  </p>
                {% endif %}

                {% if fieldAdditionalInformationAbo %}
                  <p class="vads-u-margin--0">{{ fieldAdditionalInformationAbo.processed | phoneLinks }}</p>
                {% endif %}
              {% endif %}
            </div>
          {% endif %}

          {% if fieldDescription %}
            <!-- Description -->
            <p class="va-introtext">
              {{ fieldDescription }}
            </p>
          {% endif %}

          <!-- See more events -->
          <a class="vads-c-action-link--blue" href="/outreach-and-events/events/">
            See more events
          </a>
        </div>
      {% endif %}
    </div>
  </main>
</div>

{% include "src/site/includes/footer.html" %}
{% include "src/site/includes/debug.drupal.liquid" %}
