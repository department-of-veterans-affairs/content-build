{% assign isInAbout = false %}
{% assign lastMenu = sidebarData.links | last %}
{% assign aboutMenu = lastMenu.links | map: 'url' %}
{% assign deepLinksString = sidebarData.links | findCurrentPathDepthRecursive: entityUrl.path %}
{% assign deepLinksObj = deepLinksString | jsonToObj %}

{% comment %} A "depth" of 1 means that this page is the root level page. {% endcomment %}
{% assign depth = deepLinksObj.depth  %}

{% assign isInAbout = aboutMenu | isAboutItem: entityUrl.path %}
{% assign deepLinks = deepLinksObj.link.links %}

{% comment %} If preview mode, published and draft facilities are displayed. 
If NOT in preview mode, only published facilities are displayed.  {% endcomment %}
{% if isPreview and sidebarData.links.0.links.0.links.1.links %}
  {% assign publishedAndDraftFacilities = sidebarData.links.0.links.0.links.1.links | rejectBy: "entity.linkedEntity.moderationState", "archived"%}
  {% assign filteredSidebarData = sidebarData | setData: 'links[0]links[0]links[1]links', publishedAndDraftFacilities %}
{% elsif sidebarData.links.0.links.0.links.1.links %}
  {% assign publishedFacilities = sidebarData.links.0.links.0.links.1.links | rejectBy: "entity.linkedEntity.entityPublished", false %}
  {% assign filteredSidebarData = sidebarData | setData: 'links[0]links[0]links[1]links', publishedFacilities %}
{% endif %}

<script>console.log({{ sidebarData | json }});</script>

<script nonce="**CSP_NONCE**" type="text/javascript">
    window.sideNav = {
      rootPath: "{{ entityUrl.path }}/",
      data: {{ sidebarData | json }},
    };
</script>

{% comment %} React Widget located in `src/platform/site-wide/side-nav` {% endcomment %}
<nav data-template="navigation/facility_sidebar_nav" aria-label="secondary" data-widget-type="side-nav"></nav>

